---
# yamllint disable rule:line-length
###############################################################################
# Annotate User Configuration
###############################################################################
# Sanitize (standardize with default values if not set) Forgejo configuration.
#
# Externally stored application settings for Jellyseerr. Additional settings
# stored in jellyseerr.conf and the DB. WebUI locations are headers but all
# values are stored within config.xml. HIGHLY Recommend to configure jellyseerr
# in the WebUI and migrate settings values here.
#
# Documented usage here reflect code, installer, and WebUI analysis. These may
# change over time and should be re-validated from time to time.
#
# Use r_pufky.data.v3 data annotations to enforce consistency and validation
# checks.
#
# Generates:
#   _jellyseerr_map: list of dict - Annotated config map.
#   _jellyseerr_order: list of str - Config section order.
#
# Reference:
# * https://forgejo.org/docs/latest/admin/installation-binary
# * https://forgejo.org/docs/latest/admin/config-cheat-sheet

- name: 'Annotate | sanitize & annotate service defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _jellyseerr_srv_version: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_version,
        default=jellyseerr_role_validate_version,
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_srv_bind_address: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_bind_address,
        default='',
        _env='HOST',
        hint='str',
        order=2
        )
      }}"
    _jellyseerr_srv_port: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_port,
        default=5055,
        _env='PORT',
        hint='int',
        order=3
        )
      }}"
    _jellyseerr_srv_delete_old_versions_enable: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_delete_old_versions_enable,
        default=true,
        hint='bool',
        order=4
        )
      }}"
    _jellyseerr_srv_u_mask: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_u_mask,
        default='0002',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_srv_force_overwrite: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_force_overwrite,
        default=false,
        hint='bool',
        order=6
        )
      }}"
    _jellyseerr_srv_restart_daily_enable: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_restart_daily_enable,
        default=false,
        hint='bool',
        order=7
        )
      }}"
    _jellyseerr_srv_force_config_only_enable: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_force_config_only_enable,
        default=false,
        hint='bool',
        order=8
        )
      }}"
    _jellyseerr_srv_user: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_user,
        default='jellyseerr',
        _uid='',
        _home='',
        _nvm='',
        hint='str',
        comment='Local user nvm install path, resolved home directory.',
        order=9
        )
      }}"
    _jellyseerr_srv_group: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_group,
        default='jellyseerr',
        _gid='',
        hint='str',
        order=10
        )
      }}"
    _jellyseerr_srv_create_user: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_create_user,
        default=true,
        hint='bool',
        order=11
        )
      }}"
    _jellyseerr_srv_user_data_manage_enable: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_user_data_manage_enable,
        default=false,
        hint='bool',
        order=12
        )
      }}"
    _jellyseerr_srv_build_memory: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_build_memory,
        data=(
          _jellyseerr_srv_build_memory
          if jellyseerr_srv_build_memory != -1 else
          ansible_memory_mb.real.total
        ),
        default=-1,
        _args='--max-old-space-size=',
        hint='int',
        order=13
        )
      }}"
    _jellyseerr_srv_build_clear_cache: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_build_clear_cache,
        default=true,
        hint='bool',
        order=14
        )
      }}"
    _jellyseerr_srv_poll_enable: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_poll_enable,
        default=true,
        hint='bool',
        order=15
        )
      }}"

# UI configuration sections do not align with JSON data structures.
- name: 'Annotate | sanitize & annotate config defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _jellyseerr_cfg_client_id: "{{ {} | r_pufky.data.v3(
        section='base',
        key='clientId',
        raw=jellyseerr_cfg_client_id,
        default=inventory_hostname | to_uuid,
        hint='str',
        sensitive=true,
        comment='UUIDv5.',
        order=1
        )
      }}"
    _jellyseerr_cfg_vapid_private: "{{ {} | r_pufky.data.v3(
        section='base',
        key='vapidPrivate',
        raw=jellyseerr_cfg_vapid_private,
        default='',
        hint='str',
        sensitive=true,
        order=2
        )
      }}"
    _jellyseerr_cfg_vapid_public: "{{ {} | r_pufky.data.v3(
        section='base',
        key='vapidPrivate',
        raw=jellyseerr_cfg_vapid_public,
        default='',
        hint='str',
        order=3
        )
      }}"
    _jellyseerr_cfg_api_key: "{{ {} | r_pufky.data.v3(
        section='main',
        key='apiKey',
        raw=jellyseerr_cfg_api_key,
        default=inventory_hostname | to_uuid | b64encode,
        hint='str',
        sensitive=true,
        comment='UUIDv5 base64.',
        order=1
        )
      }}"
    _jellyseerr_cfg_application_title: "{{ {} | r_pufky.data.v3(
        section='main',
        key='applicationTitle',
        raw=jellyseerr_cfg_application_title,
        default='Jellyseerr',
        hint='str',
        order=2
        )
      }}"
    _jellyseerr_cfg_application_url: "{{ {} | r_pufky.data.v3(
        section='main',
        key='applicationUrl',
        raw=jellyseerr_cfg_application_url,
        default='',
        hint='str',
        order=3
        )
      }}"
    _jellyseerr_cfg_cache_images: "{{ {} | r_pufky.data.v3(
        section='main',
        key='cacheImages',
        raw=jellyseerr_cfg_cache_images,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _jellyseerr_cfg_default_permissions: "{{ {} | r_pufky.data.v3(
        section='main',
        key='defaultPermissions',
        raw=jellyseerr_cfg_default_permissions,
        default=32,
        hint='int',
        order=5
        )
      }}"
    _jellyseerr_srv_owner_email: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_owner_email,
        default='jellyseerr@example.com',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_srv_owner_username: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_owner_username,
        default='jellyseerr',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_srv_owner_password: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_owner_password,
        default=(
          lookup('ansible.builtin.password',
                 '/dev/null',
                 chars=['ascii_lowercase', 'ascii_uppercase', 'digits'],
                 length=32)
        ),
        hint='str',
        sensitive=true,
        order=6
        )
      }}"
    _jellyseerr_srv_owner_avatar: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_srv_owner_avatar,
        default=(
          'https://gravatar.com/avatar/' ~
          'c77fdc27cab83732b8623d2ea873d330?default=mm&size=200'
        ),
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_default_quotas_movie_quota_limit: "{{ {} | r_pufky.data.v3(
        section='main',
        key='quotaLimit',
        raw=jellyseerr_cfg_default_quotas_movie_quota_limit,
        default=0,
        hint='int',
        comment='defaultQuotas.movie',
        order=6
        )
      }}"
    _jellyseerr_cfg_default_quotas_movie_quota_days: "{{ {} | r_pufky.data.v3(
        section='main',
        key='quotaDays',
        raw=jellyseerr_cfg_default_quotas_movie_quota_days,
        default=7,
        hint='int',
        comment='defaultQuotas.movie',
        order=7
        )
      }}"
    _jellyseerr_cfg_default_quotas_tv_quota_limit: "{{ {} | r_pufky.data.v3(
        section='main',
        key='quotaLimit',
        raw=jellyseerr_cfg_default_quotas_tv_quota_limit,
        default=0,
        hint='int',
        comment='defaultQuotas.movie',
        order=8
        )
      }}"
    _jellyseerr_cfg_default_quotas_tv_quota_days: "{{ {} | r_pufky.data.v3(
        section='main',
        key='quotaDays',
        raw=jellyseerr_cfg_default_quotas_tv_quota_days,
        default=7,
        hint='int',
        comment='defaultQuotas.movie',
        order=9
        )
      }}"
    _jellyseerr_cfg_hide_available: "{{ {} | r_pufky.data.v3(
        section='main',
        key='hideAvailable',
        raw=jellyseerr_cfg_hide_available,
        default=false,
        hint='bool',
        order=10
        )
      }}"
    _jellyseerr_cfg_hide_blacklisted: "{{ {} | r_pufky.data.v3(
        section='main',
        key='hideBlacklisted',
        raw=jellyseerr_cfg_hide_blacklisted,
        default=false,
        hint='bool',
        order=11
        )
      }}"
    _jellyseerr_cfg_local_login: "{{ {} | r_pufky.data.v3(
        section='main',
        key='localLogin',
        raw=jellyseerr_cfg_local_login,
        default=true,
        hint='bool',
        order=12
        )
      }}"
    _jellyseerr_cfg_media_server_login: "{{ {} | r_pufky.data.v3(
        section='main',
        key='mediaServerLogin',
        raw=jellyseerr_cfg_media_server_login,
        default=true,
        hint='bool',
        order=13
        )
      }}"
    _jellyseerr_cfg_new_plex_login: "{{ {} | r_pufky.data.v3(
        section='main',
        key='newPlexLogin',
        raw=jellyseerr_cfg_new_plex_login,
        default=true,
        hint='bool',
        order=14
        )
      }}"
    _jellyseerr_cfg_discover_region: "{{ {} | r_pufky.data.v3(
        section='main',
        key='discoverRegion',
        raw=jellyseerr_cfg_discover_region,
        default='',
        hint='str',
        order=15
        )
      }}"
    _jellyseerr_cfg_streaming_region: "{{ {} | r_pufky.data.v3(
        section='main',
        key='streamingRegion',
        raw=jellyseerr_cfg_streaming_region,
        default='US',
        hint='str',
        order=16
        )
      }}"
    _jellyseerr_cfg_original_language: "{{ {} | r_pufky.data.v3(
        section='main',
        key='originalLanguage',
        raw=jellyseerr_cfg_original_language,
        data=jellyseerr_cfg_original_language | join('|'),
        default=['en'],
        hint='list of str',
        order=17
        )
      }}"
    _jellyseerr_cfg_blacklisted_tags: "{{ {} | r_pufky.data.v3(
        section='main',
        key='blacklistedTags',
        raw=jellyseerr_cfg_blacklisted_tags,
        data=jellyseerr_cfg_blacklisted_tags | join(','),
        default=[],
        hint='list of int',
        order=18
        )
      }}"
    _jellyseerr_cfg_blacklisted_tags_limit: "{{ {} | r_pufky.data.v3(
        section='main',
        key='blacklistedTagsLimit',
        raw=jellyseerr_cfg_blacklisted_tags_limit,
        default=50,
        hint='int',
        order=19
        )
      }}"
    _jellyseerr_cfg_media_server_type: "{{ {} | r_pufky.data.v3(
        section='main',
        key='mediaServerType',
        raw=jellyseerr_cfg_media_server_type,
        default=1,
        hint='int',
        order=20
        )
      }}"
    _jellyseerr_cfg_partial_requests_enabled: "{{ {} | r_pufky.data.v3(
        section='main',
        key='partialRequestsEnabled',
        raw=jellyseerr_cfg_partial_requests_enabled,
        default=true,
        hint='bool',
        order=21
        )
      }}"
    _jellyseerr_cfg_enable_special_episodes: "{{ {} | r_pufky.data.v3(
        section='main',
        key='enableSpecialEpisodes',
        raw=jellyseerr_cfg_enable_special_episodes,
        default=false,
        hint='bool',
        order=22
        )
      }}"
    _jellyseerr_cfg_locale: "{{ {} | r_pufky.data.v3(
        section='main',
        key='locale',
        raw=jellyseerr_cfg_locale | lower,
        default='en',
        hint='str',
        order=23
        )
      }}"
    _jellyseerr_cfg_youtube_url: "{{ {} | r_pufky.data.v3(
        section='main',
        key='youtubeUrl',
        raw=jellyseerr_cfg_youtube_url,
        default='',
        hint='str',
        order=24
        )
      }}"
    _jellyseerr_cfg_plex_name: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='name',
        raw=jellyseerr_cfg_plex_name,
        default='',
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_cfg_plex_ip: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='ip',
        raw=jellyseerr_cfg_plex_ip,
        default='',
        hint='str',
        order=2
        )
      }}"
    _jellyseerr_cfg_plex_port: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='port',
        raw=jellyseerr_cfg_plex_port,
        default=32400,
        hint='int',
        order=3
        )
      }}"
    _jellyseerr_cfg_plex_use_ssl: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='useSsl',
        raw=jellyseerr_cfg_plex_use_ssl,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _jellyseerr_cfg_plex_libraries: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='libraries',
        raw=jellyseerr_cfg_plex_libraries,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=5
        )
      }}"
    _jellyseerr_cfg_plex_web_app_url: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='webAppUrl',
        raw=jellyseerr_cfg_plex_web_app_url,
        default='',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_plex_machine_id: "{{ {} | r_pufky.data.v3(
        section='plex',
        key='machineId',
        raw=jellyseerr_cfg_plex_machine_id,
        default='',
        hint='str',
        sensitive=true,
        order=6
        )
      }}"
    _jellyseerr_cfg_jellyfin_name: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='name',
        raw=jellyseerr_cfg_jellyfin_name,
        default='',
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_cfg_jellyfin_ip: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='ip',
        raw=jellyseerr_cfg_jellyfin_ip,
        default='',
        hint='str',
        order=2
        )
      }}"
    _jellyseerr_cfg_jellyfin_port: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='port',
        raw=jellyseerr_cfg_jellyfin_port,
        default=8096,
        hint='int',
        order=3
        )
      }}"
    _jellyseerr_cfg_jellyfin_use_ssl: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='useSsl',
        raw=jellyseerr_cfg_jellyfin_use_ssl,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _jellyseerr_cfg_jellyfin_url_base: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='urlBase',
        raw=jellyseerr_cfg_jellyfin_url_base,
        default='',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_cfg_jellyfin_external_hostname: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='externalHostname',
        raw=jellyseerr_cfg_jellyfin_external_hostname,
        default='',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_jellyfin_jellyfin_forgot_password_url: "{{
      {} | r_pufky.data.v3(
        section='jellyfin',
        key='jellyfinForgotPasswordUrl',
        raw=jellyseerr_cfg_jellyfin_jellyfin_forgot_password_url,
        default='',
        hint='str',
        order=7
        )
      }}"
    _jellyseerr_cfg_jellyfin_libraries: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='libraries',
        raw=jellyseerr_cfg_jellyfin_libraries,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict',
        order=8
        )
      }}"
    _jellyseerr_cfg_jellyfin_server_id: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='serverId',
        raw=jellyseerr_cfg_jellyfin_server_id,
        default='',
        hint='str',
        sensitive=true,
        order=9
        )
      }}"
    _jellyseerr_cfg_jellyfin_api_key: "{{ {} | r_pufky.data.v3(
        section='jellyfin',
        key='apiKey',
        raw=jellyseerr_cfg_jellyfin_api_key,
        default='',
        hint='str',
        sensitive=true,
        order=10
        )
      }}"
    _jellyseerr_cfg_tautulli_hostname: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='hostname',
        raw=jellyseerr_cfg_tautulli_hostname,
        default='',
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_cfg_tautulli_port: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='port',
        raw=jellyseerr_cfg_tautulli_port,
        default=8181,
        hint='int',
        order=2
        )
      }}"
    _jellyseerr_cfg_tautulli_use_ssl: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='useSsl',
        raw=jellyseerr_cfg_tautulli_use_ssl,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _jellyseerr_cfg_tautulli_url_base: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='urlBase',
        raw=jellyseerr_cfg_tautulli_url_base,
        default='',
        hint='str',
        order=4
        )
      }}"
    _jellyseerr_cfg_tautulli_api_key: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='apiKey',
        raw=jellyseerr_cfg_tautulli_api_key,
        default='',
        hint='str',
        sensitive=true,
        order=5
        )
      }}"
    _jellyseerr_cfg_tautulli_external_url: "{{ {} | r_pufky.data.v3(
        section='tautulli',
        key='externalUrl',
        raw=jellyseerr_cfg_tautulli_external_url,
        default='',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_radarr: "{{ {} | r_pufky.data.v3(
        section='radarr',
        raw=jellyseerr_cfg_radarr,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _jellyseerr_cfg_sonarr: "{{ {} | r_pufky.data.v3(
        section='sonarr',
        raw=jellyseerr_cfg_sonarr,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _jellyseerr_cfg_public_initialized: "{{ {} | r_pufky.data.v3(
        section='public',
        key='initialized',
        raw=jellyseerr_cfg_public_initialized,
        default=true,
        hint='bool',
        comment='Override configuration done in database.',
        order=1
        )
      }}"
    _jellyseerr_cfg_agents_email_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_email_enabled,
        default=false,
        hint='bool',
        order=1
        )
      }}"
    _jellyseerr_cfg_agents_email_user_email_required: "{{
      {} | r_pufky.data.v3(
        section='notifications',
        key='userEmailRequired',
        raw=jellyseerr_cfg_agents_email_user_email_required,
        default=false,
        hint='bool',
        order=2
        )
      }}"
    _jellyseerr_cfg_agents_email_email_from: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='emailFrom',
        raw=jellyseerr_cfg_agents_email_email_from,
        default='',
        hint='str',
        order=3
        )
      }}"
    _jellyseerr_cfg_agents_email_smtp_host: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='smtpHost',
        raw=jellyseerr_cfg_agents_email_smtp_host,
        default='',
        hint='str',
        order=4
        )
      }}"
    _jellyseerr_cfg_agents_email_smtp_port: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='smtpPort',
        raw=jellyseerr_cfg_agents_email_smtp_port,
        default='',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_cfg_agents_email_secure: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='secure',
        raw=jellyseerr_cfg_agents_email_secure,
        default=false,
        hint='bool',
        order=6
        )
      }}"
    _jellyseerr_cfg_agents_email_ignore_tls: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='ignoreTls',
        raw=jellyseerr_cfg_agents_email_ignore_tls,
        default=false,
        hint='bool',
        order=7
        )
      }}"
    _jellyseerr_cfg_agents_email_require_tls: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='requireTls',
        raw=jellyseerr_cfg_agents_email_require_tls,
        default=false,
        hint='bool',
        order=8
        )
      }}"
    _jellyseerr_cfg_agents_email_auth_user: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='authUser',
        raw=jellyseerr_cfg_agents_email_auth_user,
        default='',
        hint='str',
        order=9
        )
      }}"
    _jellyseerr_cfg_agents_email_auth_pass: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='authPass',
        raw=jellyseerr_cfg_agents_email_auth_pass,
        default=(
          lookup('ansible.builtin.password',
                 '/dev/null',
                 chars=['ascii_lowercase', 'ascii_uppercase', 'digits'],
                 length=32)
        ),
        hint='str',
        sensitive=true,
        order=10
        )
      }}"
    _jellyseerr_cfg_agents_email_allow_self_signed: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='allowSelfSigned',
        raw=jellyseerr_cfg_agents_email_allow_self_signed,
        default=false,
        hint='bool',
        order=11
        )
      }}"
    _jellyseerr_cfg_agents_email_sender_name: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='senderName',
        raw=jellyseerr_cfg_agents_email_sender_name,
        default='Jellyseerr',
        hint='str',
        order=12
        )
      }}"
    _jellyseerr_cfg_agents_email_pgp_private_key: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='pgpPrivateKey',
        raw=jellyseerr_cfg_agents_email_pgp_private_key,
        default='',
        hint='str',
        sensitive=true,
        order=13
        )
      }}"
    _jellyseerr_cfg_agents_email_pgp_password: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='pgpPassword',
        raw=jellyseerr_cfg_agents_email_pgp_password,
        default=(
           lookup('ansible.builtin.password',
                  '/dev/null',
                  chars=['ascii_lowercase', 'ascii_uppercase', 'digits'],
                  length=32)
        ),
        hint='str',
        sensitive=true,
        order=14
        )
      }}"
    _jellyseerr_cfg_agents_discord_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_discord_enabled,
        default=false,
        hint='bool',
        order=15
        )
      }}"
    _jellyseerr_cfg_agents_discord_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_discord_types,
        default=0,
        hint='int',
        order=16
        )
      }}"
    _jellyseerr_cfg_agents_discord_webhook_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='webhookUrl',
        raw=jellyseerr_cfg_agents_discord_webhook_url,
        default='',
        hint='str',
        sensitive=true,
        order=17
        )
      }}"
    _jellyseerr_cfg_agents_discord_bot_username: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='botUsername',
        raw=jellyseerr_cfg_agents_discord_bot_username,
        default='',
        hint='str',
        order=18
        )
      }}"
    _jellyseerr_cfg_agents_discord_bot_avatar_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='botAvatarUrl',
        raw=jellyseerr_cfg_agents_discord_bot_avatar_url,
        default='',
        hint='str',
        order=19
        )
      }}"
    _jellyseerr_cfg_agents_discord_webhook_role_id: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='webhookRoleId',
        raw=jellyseerr_cfg_agents_discord_webhook_role_id,
        default='',
        hint='str',
        order=20
        )
      }}"
    _jellyseerr_cfg_agents_discord_enable_mentions: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enableMentions',
        raw=jellyseerr_cfg_agents_discord_enable_mentions,
        default=true,
        hint='bool',
        order=21
        )
      }}"
    _jellyseerr_cfg_agents_slack_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_slack_enabled,
        default=false,
        hint='bool',
        order=22
        )
      }}"
    _jellyseerr_cfg_agents_slack_webhook_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='webhookUrl',
        raw=jellyseerr_cfg_agents_slack_webhook_url,
        default='',
        hint='str',
        sensitive=true,
        order=23
        )
      }}"
    _jellyseerr_cfg_agents_slack_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_slack_types,
        default=0,
        hint='int',
        order=24
        )
      }}"
    _jellyseerr_cfg_agents_telegram_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_telegram_enabled,
        default=false,
        hint='bool',
        order=25
        )
      }}"
    _jellyseerr_cfg_agents_telegram_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_telegram_types,
        default=0,
        hint='int',
        order=26
        )
      }}"
    _jellyseerr_cfg_agents_telegram_bot_api: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='botAPI',
        raw=jellyseerr_cfg_agents_telegram_bot_api,
        default='',
        hint='str',
        sensitive=true,
        order=27
        )
      }}"
    _jellyseerr_cfg_agents_telegram_chat_id: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='chatId',
        raw=jellyseerr_cfg_agents_telegram_chat_id,
        default='',
        hint='str',
        order=28
        )
      }}"
    _jellyseerr_cfg_agents_telegram_message_thread_id: "{{
      {} | r_pufky.data.v3(
        section='notifications',
        key='messageThreadId',
        raw=jellyseerr_cfg_agents_telegram_message_thread_id,
        default='',
        hint='str',
        order=29
        )
      }}"
    _jellyseerr_cfg_agents_telegram_send_silently: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='sendSilently',
        raw=jellyseerr_cfg_agents_telegram_send_silently,
        default=false,
        hint='bool',
        order=30
        )
      }}"
    _jellyseerr_cfg_agents_telegram_bot_username: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='botUsername',
        raw=jellyseerr_cfg_agents_telegram_bot_username,
        default='',
        hint='str',
        order=31
        )
      }}"
    _jellyseerr_cfg_agents_pushbullet_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_pushbullet_enabled,
        default=false,
        hint='bool',
        order=32
        )
      }}"
    _jellyseerr_cfg_agents_pushbullet_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_pushbullet_types,
        default=0,
        hint='int',
        order=33
        )
      }}"
    _jellyseerr_cfg_agents_pushbullet_access_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='accessToken',
        raw=jellyseerr_cfg_agents_pushbullet_access_token,
        default='',
        hint='str',
        sensitive=true,
        order=34
        )
      }}"
    _jellyseerr_cfg_agents_pushbullet_channel_tag: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='channelTag',
        raw=jellyseerr_cfg_agents_pushbullet_channel_tag,
        default='',
        hint='str',
        order=35
        )
      }}"
    _jellyseerr_cfg_agents_pushover_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_pushover_enabled,
        default=false,
        hint='bool',
        order=36
        )
      }}"
    _jellyseerr_cfg_agents_pushover_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_pushover_types,
        default=0,
        hint='int',
        order=37
        )
      }}"
    _jellyseerr_cfg_agents_pushover_access_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='accessToken',
        raw=jellyseerr_cfg_agents_pushover_access_token,
        default='',
        hint='str',
        sensitive=true,
        order=38
        )
      }}"
    _jellyseerr_cfg_agents_pushover_user_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='userToken',
        raw=jellyseerr_cfg_agents_pushover_user_token,
        default='',
        hint='str',
        sensitive=true,
        order=39
        )
      }}"
    _jellyseerr_cfg_agents_pushover_sound: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='sound',
        raw=jellyseerr_cfg_agents_pushover_sound,
        default='',
        hint='str',
        order=40
        )
      }}"
    _jellyseerr_cfg_agents_webhook_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_webhook_enabled,
        default=false,
        hint='bool',
        order=41
        )
      }}"
    _jellyseerr_cfg_agents_webhook_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_webhook_types,
        default=0,
        hint='int',
        order=42
        )
      }}"
    _jellyseerr_cfg_agents_webhook_webhook_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='webhookUrl',
        raw=jellyseerr_cfg_agents_webhook_webhook_url,
        default='',
        hint='str',
        order=43
        )
      }}"
    _jellyseerr_cfg_agents_webhook_auth_header: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='authHeader',
        raw=jellyseerr_cfg_agents_webhook_auth_header,
        default='',
        hint='str',
        sensitive=true,
        order=44
        )
      }}"
    _jellyseerr_cfg_agents_webhook_json_payload: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='jsonPayload',
        raw=jellyseerr_cfg_agents_webhook_json_payload,
        default='Int9Ig==',
        hint='str',
        comment='Empty payload ({}).',
        order=45
        )
      }}"
    _jellyseerr_cfg_agents_webpush_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_webpush_enabled,
        default=false,
        hint='bool',
        order=46
        )
      }}"
    _jellyseerr_cfg_agents_gotify_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_gotify_enabled,
        default=false,
        hint='bool',
        order=47
        )
      }}"
    _jellyseerr_cfg_agents_gotify_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_gotify_types,
        default=0,
        hint='int',
        order=48
        )
      }}"
    _jellyseerr_cfg_agents_gotify_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='url',
        raw=jellyseerr_cfg_agents_gotify_url,
        default='',
        hint='str',
        order=49
        )
      }}"
    _jellyseerr_cfg_agents_gotify_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='token',
        raw=jellyseerr_cfg_agents_gotify_token,
        default='',
        hint='str',
        sensitive=true,
        order=50
        )
      }}"
    _jellyseerr_cfg_agents_gotify_priority: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='priority',
        raw=jellyseerr_cfg_agents_gotify_priority,
        default=0,
        hint='int',
        order=51
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_enabled: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='enabled',
        raw=jellyseerr_cfg_agents_ntfy_enabled,
        default=false,
        hint='bool',
        order=52
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_types: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='types',
        raw=jellyseerr_cfg_agents_ntfy_types,
        default=0,
        hint='int',
        order=53
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_url: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='url',
        raw=jellyseerr_cfg_agents_ntfy_url,
        default='',
        hint='str',
        order=54
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_topic: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='topic',
        raw=jellyseerr_cfg_agents_ntfy_topic,
        default='',
        hint='str',
        order=55
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_auth_method_username_password: "{{
      {} | r_pufky.data.v3(
        section='notifications',
        key='v',
        raw=jellyseerr_cfg_agents_ntfy_auth_method_username_password,
        default=false,
        hint='bool',
        order=56
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_username: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='username',
        raw=jellyseerr_cfg_agents_ntfy_username,
        default='',
        hint='str',
        order=56
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_password: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='password',
        raw=jellyseerr_cfg_agents_ntfy_password,
        default='',
        hint='str',
        sensitive=true,
        order=57
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_auth_method_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='authMethodToken',
        raw=jellyseerr_cfg_agents_ntfy_auth_method_token,
        default=false,
        hint='bool',
        order=58
        )
      }}"
    _jellyseerr_cfg_agents_ntfy_token: "{{ {} | r_pufky.data.v3(
        section='notifications',
        key='token',
        raw=jellyseerr_cfg_agents_ntfy_token,
        default='',
        hint='str',
        sensitive=true,
        order=59
        )
      }}"
    _jellyseerr_cfg_jobs_plex_recently_added_scan: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='plex-recently-added-scan',
        raw=jellyseerr_cfg_jobs_plex_recently_added_scan,
        default='0 */5 * * * *',
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_cfg_jobs_plex_full_scan: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='plex-full-scan',
        raw=jellyseerr_cfg_jobs_plex_full_scan,
        default='0 0 3 * * *',
        hint='str',
        order=2
        )
      }}"
    _jellyseerr_cfg_jobs_plex_watchlist_sync: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='plex-watchlist-sync',
        raw=jellyseerr_cfg_jobs_plex_watchlist_sync,
        default='0 */3 * * * *',
        hint='str',
        order=3
        )
      }}"
    _jellyseerr_cfg_jobs_plex_refresh_token: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='plex-refresh-token',
        raw=jellyseerr_cfg_jobs_plex_refresh_token,
        default='0 0 5 * * *',
        hint='str',
        order=4
        )
      }}"
    _jellyseerr_cfg_jobs_radarr_scan: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='radarr-scan',
        raw=jellyseerr_cfg_jobs_radarr_scan,
        default='0 0 4 * * *',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_cfg_jobs_sonarr_scan: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='sonarr-scan',
        raw=jellyseerr_cfg_jobs_sonarr_scan,
        default='0 30 4 * * *',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_jobs_availability_sync: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='availability-sync',
        raw=jellyseerr_cfg_jobs_availability_sync,
        default='0 0 5 * * *',
        hint='str',
        order=7
        )
      }}"
    _jellyseerr_cfg_jobs_download_sync: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='download-sync',
        raw=jellyseerr_cfg_jobs_download_sync,
        default='0 * * * * *',
        hint='str',
        order=8
        )
      }}"
    _jellyseerr_cfg_jobs_download_sync_reset: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='download-sync-reset',
        raw=jellyseerr_cfg_jobs_download_sync_reset,
        default='0 0 1 * * *',
        hint='str',
        order=9
        )
      }}"
    _jellyseerr_cfg_jobs_jellyfin_recently_added_scan: "{{
      {} | r_pufky.data.v3(
        section='jobs',
        key='jellyfin-recently-added-scan',
        raw=jellyseerr_cfg_jobs_jellyfin_recently_added_scan,
        default='0 0/5 * * * *',
        hint='str',
        order=10
        )
      }}"
    _jellyseerr_cfg_jobs_jellyfin_full_scan: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='jellyfin-full-scan',
        raw=jellyseerr_cfg_jobs_jellyfin_full_scan,
        default='0 0 3 * * *',
        hint='str',
        order=11
        )
      }}"
    _jellyseerr_cfg_jobs_image_cache_cleanup: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='image-cache-cleanup',
        raw=jellyseerr_cfg_jobs_image_cache_cleanup,
        default='0 0 5 * * *',
        hint='str',
        order=12
        )
      }}"
    _jellyseerr_cfg_jobs_process_blacklisted_tags: "{{ {} | r_pufky.data.v3(
        section='jobs',
        key='process-blacklisted-tags',
        raw=jellyseerr_cfg_jobs_process_blacklisted_tags,
        default='0 30 1 */7 * *',
        hint='str',
        order=13
        )
      }}"
    _jellyseerr_cfg_csrf_protection: "{{ {} | r_pufky.data.v3(
        section='network',
        key='csrfProtection',
        raw=jellyseerr_cfg_csrf_protection,
        default=false,
        hint='bool',
        order=1
        )
      }}"
    _jellyseerr_cfg_force_ipv4_first: "{{ {} | r_pufky.data.v3(
        section='network',
        key='forceIpv4First',
        raw=jellyseerr_cfg_force_ipv4_first,
        default=false,
        _env='FORCE_IPV4_FIRST',
        hint='bool',
        order=2
        )
      }}"
    _jellyseerr_cfg_trust_proxy: "{{ {} | r_pufky.data.v3(
        section='network',
        key='trustProxy',
        raw=jellyseerr_cfg_trust_proxy,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _jellyseerr_cfg_proxy_enabled: "{{ {} | r_pufky.data.v3(
        section='network',
        key='enabled',
        raw=jellyseerr_cfg_proxy_enabled,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _jellyseerr_cfg_proxy_hostname: "{{ {} | r_pufky.data.v3(
        section='network',
        key='hostname',
        raw=jellyseerr_cfg_proxy_hostname,
        default='',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_cfg_proxy_port: "{{ {} | r_pufky.data.v3(
        section='network',
        key='port',
        raw=jellyseerr_cfg_proxy_port,
        default=8080,
        hint='int',
        order=6
        )
      }}"
    _jellyseerr_cfg_proxy_use_ssl: "{{ {} | r_pufky.data.v3(
        section='network',
        key='useSsl',
        raw=jellyseerr_cfg_proxy_use_ssl,
        default=false,
        hint='bool',
        order=7
        )
      }}"
    _jellyseerr_cfg_proxy_user: "{{ {} | r_pufky.data.v3(
        section='network',
        key='user',
        raw=jellyseerr_cfg_proxy_user,
        default='',
        hint='str',
        order=8
        )
      }}"
    _jellyseerr_cfg_proxy_password: "{{ {} | r_pufky.data.v3(
        section='network',
        key='password',
        raw=jellyseerr_cfg_proxy_password,
        default='',
        hint='atr',
        sensitive=true,
        order=9
        )
      }}"
    _jellyseerr_cfg_proxy_bypass_filter: "{{ {} | r_pufky.data.v3(
        section='network',
        key='bypassFilter',
        raw=jellyseerr_cfg_proxy_bypass_filter,
        data=jellyseerr_cfg_proxy_bypass_filter | join(','),
        default=[],
        hint='list of str',
        order=10
        )
      }}"
    _jellyseerr_cfg_proxy_bypass_local_addresses: "{{ {} | r_pufky.data.v3(
        section='network',
        key='bypassLocalAddresses',
        raw=jellyseerr_cfg_proxy_bypass_local_addresses,
        default=true,
        hint='bool',
        order=11
        )
      }}"
    _jellyseerr_cfg_db_type: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_type | lower,
        default='sqlite',
        _env='DB_TYPE',
        hint='str',
        order=1
        )
      }}"
    _jellyseerr_cfg_db_log_queries: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_log_queries,
        default=false,
        _env='DB_LOG_QUERIES',
        hint='bool',
        order=2
        )
      }}"
    _jellyseerr_cfg_db_host: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_host,
        default='localhost',
        _env='DB_HOST',
        hint='str',
        order=3
        )
      }}"
    _jellyseerr_cfg_db_port: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_port,
        default=5432,
        _env='DB_PORT',
        hint='port',
        order=4
        )
      }}"
    _jellyseerr_cfg_db_socket_path: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_socket_path,
        default='',
        _env='DB_SOCKET_PATH',
        hint='str',
        order=5
        )
      }}"
    _jellyseerr_cfg_db_user: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_user,
        default='jellyseerr',
        _env='DB_USER',
        hint='str',
        order=6
        )
      }}"
    _jellyseerr_cfg_db_pass: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_pass,
        default='jellyseerr',
        _env='DB_PASS',
        hint='str',
        sensitive=true,
        order=7
        )
      }}"
    _jellyseerr_cfg_db_name: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_name,
        default='jellyseerr',
        _env='DB_NAME',
        hint='str',
        sensitive=true,
        order=8
        )
      }}"
    _jellyseerr_cfg_db_use_ssl: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_use_ssl,
        default=false,
        _env='DB_USE_SSL',
        hint='bool',
        sensitive=true,
        order=9
        )
      }}"
    _jellyseerr_cfg_db_ssl_reject_unauthorized: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_ssl_reject_unauthorized,
        default=true,
        _env='DB_SSL_REJECT_UNAUTHORIZED',
        hint='bool',
        sensitive=true,
        order=10
        )
      }}"
    _jellyseerr_cfg_db_ssl_ca_file: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_ssl_ca_file,
        default='',
        _dest='/opt/jellyseerr/jellyseerr/config/ca.cert',
        _perms='0644',
        _env='DB_SSL_CA_FILE',
        hint='str',
        sensitive=true,
        order=12
        )
      }}"
    _jellyseerr_cfg_db_ssl_key_file: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_ssl_key_file,
        default='',
        _dest='/opt/jellyseerr/jellyseerr/config/key.pem',
        _perms='0640',
        _env='DB_SSL_KEY_FILE',
        hint='str',
        sensitive=true,
        order=14
        )
      }}"
    _jellyseerr_cfg_db_ssl_cert_file: "{{ {} | r_pufky.data.v3(
        raw=jellyseerr_cfg_db_ssl_cert_file,
        default='',
        _dest='/opt/jellyseerr/jellyseerr/config/chain.pem',
        _perms='0640',
        _env='DB_SSL_CERT_FILE',
        hint='str',
        sensitive=true,
        order=16
        )
      }}"

- name: 'Annotate | merge template jellyseerr_cfg_plex_libraries'
  ansible.builtin.set_fact:  # noqa jinja[spacing] more readable.
    _jellyseerr_cfg_plex_libraries: '{{
        _jellyseerr_cfg_plex_libraries |
        combine({
              "data": _jellyseerr_cfg_plex_libraries.data | default([]) +
            [jellyseerr_role_template_media_server_libraries | combine(item)]
          })
      }}'
  loop: '{{ _jellyseerr_cfg_plex_libraries.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template jellyseerr_cfg_jellyfin_libraries'
  ansible.builtin.set_fact:  # noqa jinja[spacing] more readable.
    _jellyseerr_cfg_jellyfin_libraries: '{{
        _jellyseerr_cfg_jellyfin_libraries |
        combine({
              "data": _jellyseerr_cfg_jellyfin_libraries.data | default([]) +
            [jellyseerr_role_template_media_server_libraries | combine(item)]
          })
      }}'
  loop: '{{ _jellyseerr_cfg_jellyfin_libraries.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template jellyseerr_cfg_radarr'
  ansible.builtin.set_fact:  # noqa jinja[spacing] more readable.
    _jellyseerr_cfg_radarr: '{{
        _jellyseerr_cfg_radarr |
        combine({
              "data": _jellyseerr_cfg_radarr.data | default([]) +
            [jellyseerr_role_template_radarr | combine(item)]
          })
      }}'
  loop: '{{ _jellyseerr_cfg_radarr.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template jellyseerr_cfg_sonarr'
  ansible.builtin.set_fact:  # noqa jinja[spacing] more readable.
    _jellyseerr_cfg_sonarr: '{{
        _jellyseerr_cfg_sonarr |
        combine({
              "data": _jellyseerr_cfg_sonarr.data | default([]) +
            [jellyseerr_role_template_sonarr | combine(item)]
          })
      }}'
  loop: '{{ _jellyseerr_cfg_sonarr.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | generate config map'
  ansible.builtin.set_fact:
    _jellyseerr_map: '{{
        hostvars[inventory_hostname] | dict2items |
        selectattr("key", "match", "_jellyseerr_cfg_*")
      }}'
    _jellyseerr_order:
      - 'base'
      - 'main'
      - 'plex'
      - 'jellyfin'
      - 'tautulli'
      - 'radarr'
      - 'sonarr'
      - 'public'
      - 'notifications'
      - 'jobs'
      - 'network'
